#!@SCRIPT_SH@
#	$Header: /usr/people/sam/fax/./html/tools/RCS/faq-feedback.sh.in,v 1.9 1995/04/08 21:47:59 sam Rel $
#
# Copyright (c) 1994-1995 Sam Leffler
# Copyright (c) 1994-1995 Silicon Graphics, Inc.
# 
# Permission to use, copy, modify, distribute, and sell this software and 
# its documentation for any purpose is hereby granted without fee, provided
# that (i) the above copyright notices and this permission notice appear in
# all copies of the software and related documentation, and (ii) the names of
# Sam Leffler and Silicon Graphics may not be used in any advertising or
# publicity relating to the software without the specific, prior written
# permission of Sam Leffler and Silicon Graphics.
# 
# THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY 
# WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  
# 
# IN NO EVENT SHALL SAM LEFFLER OR SILICON GRAPHICS BE LIABLE FOR
# ANY SPECIAL, INCIDENTAL, INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND,
# OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,
# WHETHER OR NOT ADVISED OF THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF 
# LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE 
# OF THIS SOFTWARE.
#

#
# Feedback form for the HylaFAX FAQ
#
PATH=/bin:/usr/bin
test -d /usr/sbin && PATH=$PATH:/usr/sbin		# SGI and others
test -d /usr/5bin && PATH=/usr/5bin:$PATH		# Sun and others
test -d /usr/local/bin && PATH=/usr/local/bin:$PATH	# for GNU stuff

SENDMAIL=@SENDMAIL@
ECHO=@ECHO@
SED=@SED@
CAT=@CAT@
UNQUOTE=@CGIDIR@/unquote

case $0 in
*post)	POST=yes;;
*)	POST=no;;
esac

$ECHO 'Content-type: text/html'
$ECHO ''
#$ECHO '<PRE>';printenv; echo '</PRE>'

#
# Be careful here.
#
eval `$ECHO "$QUERY_STRING" | $UNQUOTE -qn | $SED 's/PATH=[^;]*;//g'`

test -z "$ToAddr"			&& ToAddr="FlexFAQ@flake.asd.sgi.com"
test -z "$REMOTE_USER"			&& REMOTE_USER=someone
test -z "$REMOTE_HOST"			&& REMOTE_HOST=$REMOTE_ADDR
test -z "$MailAddr" -a "$REMOTE_HOST"	&& MailAddr="$REMOTE_USER@$REMOTE_HOST"

echoMail()
{
    $ECHO "To: $ToAddr"
    $ECHO "Subject: Comments on \"$Question\"" | $UNQUOTE
    if [ "$RealName" ]; then
	$ECHO "From: $MailAddr ($RealName)"
    else
	$ECHO "From: $MailAddr"
    fi
    $ECHO ""
    $ECHO "$Comments" | $UNQUOTE
}

putFooter()
{
    $CAT<<'EOF'
<HR>
<ADDRESS>
<A HREF="@HTMLPATH@/sam.html">Sam Leffler</A> / <A HREF="mailto:sam@engr.sgi.com">sam@engr.sgi.com</A>.
Last updated $Date: 1995/04/08 21:47:59 $.
</ADDRESS>
</BODY></HTML>
EOF
}

noToAddress()
{
    $CAT<<EOF
<H1><IMG SRC="@HTMLPATH@/icons/button.excl.gif" HSPACE=10>
Error: No To: E-mail Address Specified</H1>
This script was improperly invoked.  No E-mail address was
specified to send the comments form to.  Please notify the local
<A HREF=mailto:webmaster@$HOST>administrator of this server</A>
and if possible include the body of this document and any related
URL information such as the URL of the document the script was
invoked from.
EOF
    putFooter
}

noMailAddr()
{
    $CAT<<'EOF'
<IMG SRC="@HTMLPATH@/icons/button.excl.gif" WIDTH=42 HEIGHT=42 HSPACE=10>
<BASEFONT SIZE=4>
<B><FONT SIZE=+3>E</FONT>RROR: <FONT SIZE=+2>N</FONT>O <FONT SIZE=+2>E</FONT>-MAIL <FONT SIZE=+2>A</FONT>DDRESS <FONT SIZE=+2>S</FONT>PECIFIED</B>
<BASEFONT SIZE=3>
<P>
Your comments were not posted because you failed to
fillin your electronic mail address.  Please complete the
unspecified fields in the form below and resubmit your request.
<HR SIZE=4>
EOF
    putForm
    putFooter
}

mailFailed()
{
    $CAT<<EOF
<IMG SRC="@HTMLPATH@/icons/button.excl.gif" WIDTH=42 HEIGHT=42 HSPACE=10>
<BASEFONT SIZE=4>
<B><FONT SIZE=+3>E</FONT>RROR: <FONT SIZE=+2>M</FONT>AIL <FONT SIZE=+2>P</FONT>OST <FONT SIZE=+2>F</FONT>AILED</B>
<BASEFONT SIZE=3>
<P>
Sorry, there was a problem posting your FlexFAQ feedback.
The following command failed:<PRE>
    $*
</PRE>
Please notify <A HREF=mailto:webmaster@$HOST>webmaster@$HOST</A>.
EOF
    putFooter
}

noComments()
{
    $CAT<<EOF
<IMG SRC="@HTMLPATH@/icons/button.excl.gif" WIDTH=42 HEIGHT=42 HSPACE=10>
<BASEFONT SIZE=4>
<B><FONT SIZE=+3>E</FONT>RROR: <FONT SIZE=+2>N</FONT>O <FONT SIZE=+2>C</FONT>OMMENTS <FONT SIZE=+2>P</FONT>ROVIDED</B>
<BASEFONT SIZE=3>
<P>
You did not provide any comments.  If you really want to provide
feedback, please complete the unspecified fields in the form below
and resubmit your request.
<HR SIZE=4>
EOF
    putForm
    putFooter
}

putBlurb()
{
    $CAT<<EOF
<HTML><HEAD><TITLE>HylaFAQ User Feedback Form</TITLE></HEAD><BODY>
<BASEFONT SIZE=4>
<B><FONT SIZE=+3>H</FONT>YLA<FONT SIZE=+1>FAQ</FONT> <FONT SIZE=+2>U</FONT>SER <FONT SIZE=+2>F</FONT>EEDBACK <FONT SIZE=+2>F</FONT>ORM</B>
<BASEFONT SIZE=3>
<HR SIZE=4>
The HylaFAX Frequently Asked Questions document is still in its
formulative stage.  Feedback is welcome, especially any corrections
you might have for the existing materials.
When providing feedback about an existing message, please be sure to
<EM>specify the text of the question or the question
number that you are referring to</EM>.
If you use the feedback link provided at the top of each question
this information will automatically be included in your message.
<P>
If you are unable to use this form to provide feedback, you can always
send electronic mail to <A HREF="mailto:$ToAddr">$ToAddr</A>.
<HR>
EOF
}

putForm()
{
    $CAT<<EOF
<FORM METHOD=QUERY ACTION=@CGIPATH@/faq-feedback-post>
<INPUT TYPE=hidden NAME="ToAddr" VALUE=$ToAddr>
<PRE>
<B>Real Name</B>:	<INPUT TYPE=text NAME="RealName" VALUE="$RealName" SIZE=45>
<B>E-mail address</B>:	<INPUT TYPE=text NAME="MailAddr" VALUE="$MailAddr" SIZE=45>
<B>Re-Question</B>:	<INPUT TYPE=text NAME="Question" VALUE="$Question" SIZE=45>
<TEXTAREA NAME="Comments" VALUE="$Comments" ROWS=7 COLS=60></TEXTAREA>
<INPUT TYPE=submit VALUE="Send Comments"> <INPUT TYPE=reset VALUE="Reset Form">
</PRE>
</FORM>
EOF
}

if [ $POST = "yes" ]; then
    echo '<HEAD><TITLE>HylaFAQ Feedback Submission</TITLE></HEAD>'
    if [ -z "$ToAddr" ]; then
	noToAddress;
    elif [ -z "$MailAddr" -o "$MailAddr" = "someone@$REMOTE_HOST" ]; then
	noMailAddr;
    elif [ -z "$Comments" ]; then
	noComments;
    elif (echoMail | $SENDMAIL -oi "-f$MailAddr" $ToAddr); then
	$ECHO '<BASEFONT SIZE=4>'
	$ECHO '<B><FONT SIZE=+3>H</FONT>YLA<FONT SIZE=+1>FAQ</FONT> <FONT SIZE=+2>F</FONT>EEDBACK <FONT SIZE=+2>P</FONT>POSTED</B>'
	$ECHO '<BASEFONT SIZE=3>'
	$ECHO '<HR SIZE=4>'
	$ECHO "Your comments were successfully posted."
	$ECHO 'Thank you for your feedback!'
	$ECHO "<P><HR><ADDRESS>$ToAddr</ADDRESS>"
	$ECHO '</BODY></HTML>'
	exit 0
    else
	mailFailed $SENDMAIL -oi \"-f$MailAddr\" $ToAddr
    fi
else
    putBlurb
    putForm
    putFooter
fi
