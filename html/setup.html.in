<HTML>
<HEAD>
<TITLE>
Server Setup and Basic Configuration
</TITLE>
</HEAD>

<BODY>

<BASEFONT SIZE=4>
<B><FONT SIZE=+3>S</FONT>ERVER <FONT SIZE=+2>S</FONT>ETUP AND <FONT SIZE=+2>B</FONT>ASIC <FONT SIZE=+2>C</FONT>ONFIGURATION</B>
<BASEFONT SIZE=3>

<HR SIZE=4>


HylaFAX is composed of <I>client</I> and <I>server</I> applications.
Client applications are programs that normal users invoke to send
facsimile, query the status of facsimile servers, etc.
Server applications are programs that reside <EM>only on the machine
where the fax modems are present</EM>.
HylaFAX is distributed so that the normal <TT>make install</TT>
step done after <A HREF="building.html#Building">the software is built</A>
will install both client and server applications.
Client-only systems require a slightly different procedure that is
discussed in the next chapter on
<A HREF="setup-client.html">Client Setup and Operation</A>.
This chapter discusses setting up a server machine for use.

<P>
The basic steps required to setup a HylaFAX server machine are:
<OL>
<LI><A HREF="#Software">Install the HylaFAX software.</A>
<LI><A HREF="#Modem">Select a facsimile modem for use.</A>
<LI><A HREF="#Check">Check your modem is functional.</A>
<LI><A HREF="#FlowControl">Select a flow control scheme to use for facscimile communication.</A>
<LI><A HREF="#Device">Select a TTY device to use.</A>
<LI><A HREF="#Outbound">Configure the modem for outbound use by HylaFAX.</A>
<LI><A HREF="#Starting">Start/restart the HylaFAX scheduler process.</A>
<LI><A HREF="#Inbound">Setup the modem for inbound use by HylaFAX [<I>optional</I>].</A>
</OL>

It is also possible to configure a modem for inbound use only;
this is done simply by not running the HylaFAX scheduler process.
Finally, note that many decisions are system-specific.
Much system-specific guidance is sprinkled throughout these
materials; the following
sections also provide specific guidance for individual systems
where HylaFAX has been run.

<UL>
<LI><A HREF="#BSDI">BSDI Guidance</A>
<LI><A HREF="#IRIX">IRIX Guidance</A>
<LI><A HREF="#Solaris">Solaris Guidance</A>
<LI><A HREF="#SunOS">SunOS Guidance</A>
<LI><A HREF="#Ultrix">Ultrix Guidance</A>
</UL>

This chapter also has a section on
<A HREF="#Problems">Modem Configuration Issues</A>.
Advanced configuration and setup issues are discussed in a
<A HREF="setup-advanced.htl">separate chapter</A>.

<A NAME="Software"><P><HR WIDTH=65% ALIGN=right><H3>Installing HylaFAX</H3></A>

As noted previously, most installations of HylaFAX will be done
from the source code distribution.  In this case installation is done
by running

<UL><PRE><TT>
hyla# make install		# NB: must be done by the super-user
</TT></PRE></UL>

from the top-level of the build tree.

<P>
If you are working from a binary distribution the above step is also
common, though different distribution formats may require different
techniques for installing the software.  For Silicon Graphics users
the installation technique is discussed in
<A HREF="install-binary.html#IRIX">Binary Distributions for IRIX</A>.

<A NAME="Modem"><P><HR WIDTH=65% ALIGN=right><H3>Selecting a Facsimile Modem</H3></A>

Selecting a modem usually means purchasing a modem that is capable
of sending and receiving facsimile.
Most any fax-capable modem can be used with HylaFAX but not all are equal.
HylaFAX has drivers for Class 1, Class 2, and Class 2.0 facsimile
modems, but there are <A HREF="class1.html">caveats on the use of
Class 1 modems</A>.
Class 2 modems are the most common, but due to the non-standard
nature of the specification that they are implemented against
compatibility can be a problem.
Note also that the quality of Class 2 modems varies significantly.
Class 2.0 modems follow the latest standard, a ratified version of
the specification used in implementing Class 2 modems.
There are significantly fewer Class 2.0 modems available, though
the quality of these modems also varies significantly.
There is a <A HREF="modems.html">list of modems</A>
that have been tried with HylaFAX and
this list includes several modems that have been found to be
reliable for use in sending and receiving facsimile.

<A NAME="Check"><P><HR WIDTH=65% ALIGN=right><H3>Checking Your Modem</H3></A>

<P>
Once you have a modem to use with HylaFAX
first make sure that the modem works for data use.
One can not say this enough.  If you can not use
<I>cu</I>,
<I>tip</I>,
<I>kermit</I>,
or whatever with your modem, do not
try to configure it for use with HylaFAX. 
This means in particular that you should verify that you have a
working cable between
your host and modem and that this cable is suitable for use.  That is,
that the cable has the relevant signals for doing hardware flow control
if that is necessary and that it passes the DCD and DTR signals
appropriately.

<P>
Verify that the modem you are using is a fax modem.
This can be done by communicating directly with the modem or by
using the <A HREF="@CGIPATH@/manpage?1+probemodem">probemodem</A>
shell script that comes with HylaFAX.

<P>
To verify the modem can be used with HylaFAX use a communication
program such as cu to talk to the modem directly, for example:

<UL><PRE><TT>
hyla% <B>cu -l ttyf2</B>
Connected
<B>at+fclass=?</B>
0,1,2
OK
<B>~</B>[hyla]<B>.</B>
Disconnected
</TT></PRE></UL>

The <TT>at+fclass=?</TT> command asks the modem to report which
<I>classes</I> it is capable of supporting.
Class 0 is for data use.
Class 1, Class 2, and Class 2.0 are for facsimile use.
Other classes may be reported, for example, for modems that
provide digitized voice support.
HylaFAX can be used with any modem that supports Class 1, Class 2,
or Class 2.0.

<P>
The probemodem script can be used to obtain information about
which facsimile capabilities a modem implements.  It works by
sending commands to the modem to query known capabilities and
reporting the results of the queries.
probemodem is normally located in the same location as the faxaddmodem
script and is run in a similar manner:

<UL><PRE><TT>
hyla% <B>su</B>			# NB: probemodem must be run by the super-user
hyla# <B>/var/spool/fax/bin/probemodem ttym2</B>

Now we are going to probe the tty port.  This takes a few seconds,
so be patient.  Note that if you do not have the modem cabled to
the port, or the modem is turned off, this may hang (just go and
cable up the modem or turn it on, or whatever).

Probing for best speed to talk to modem: 38400 OK.

This looks like a Class 1+2 modem.

ATI0    RESULT = "OK"   RESPONSE = "144"
ATI1    RESULT = "OK"   RESPONSE = "176"
ATI2    RESULT = "OK"   RESPONSE = "OK"
ATI3    RESULT = "OK"   RESPONSE = "03134479"

Class 1 stuff...

AT+FCLASS=?     RESULT = "OK"   RESPONSE = "0,1,2"
AT+FCLASS?      RESULT = "OK"   RESPONSE = "2"
AT+FCLASS=0     RESULT = "OK"   RESPONSE = "OK"

	<I>...stuff deleted...</I>

</TT></PRE></UL>

For the purpose of verifying that a modem is capable of use with
HylaFAX, the most important information to check in the output
of probemodem is the response to the <TT>AT+FCLASS=?</TT> command.

<A NAME="FlowControl"><P><HR WIDTH=65% ALIGN=right><H3>Selecting a Flow Control Scheme</H3></A>

The rules to use for selecting a flow control method for facsimile
use are:

<UL>
<LI>If you have a Class 1 modem, then you can use either hardware or
  software flow control, but beware of using hardware flow control
  as the Class 1 specification only requires vendors to support
  software flow control (and many of the Class 1 modems tried so far
  do not properly support hardware flow control).
<LI>If you have a Class 2 or Class 2.0 modem,
  then you can use either hardware or
  software flow control, but if you are going to communicate with the
  modem faster than 9600 baud then you should probably use hardware
  flow control.
</UL>

<IMG SRC="icons/warning_icon.gif" ALT="NOTE: " ALIGN=left HSPACE=8 VSPACE=4>
<EM>Beware that although a modem may properly implement hardware
flow control when doing data communication, it may not
support hardware flow control during facsimile communication.  Consult
the <A HREF="Modems/">modem information</A> for specifics on
some modems.</EM>

<P>
If a prototype configuration file for your modem is included in the
HylaFAX distribution then the appropriate flow control scheme should
already be setup.

<A NAME="Device"><P><HR WIDTH=65% ALIGN=right><H3>Choosing a TTY Device</H3></A>

There are two things to beware of in selecting a tty device file to
use with your modem: flow control usage and port locking mechanisms.

<P>
On many systems different devices are used to select different
flow control schemes and/or whether or not the system will monitor
the DCD signal.
For example, IRIX systems use different device names to identify
devices that monitor DCD and/or support RTS/CTS flow control.
Likewise the FAS driver for SCO uses a different names
as does the standard HP-UX terminal driver.

<P>
On some systems inbound and outbound port use is interlocked by
using a pair of devices, one for inbound use and another for
outbound use.  Typically this scheme works by stopping programs that
use the inbound device until an inbound call is received (and DCD
is raised by the modem).
Outbound usage is also interlocked against applications waiting
for the inbound device.
HylaFAX provides no direct support for this because this scheme
requires that a modem
auto-answer incoming calls (something that does not work with virtually
any multi-mode, i.e. fax and data, modem).
When faced with a system that uses this you have several alternatives.
Most people elect to avoid the inbound device and run both incoming and
outgoing traffic on the outbound device, using the builtin interlocking
mechanism provided by HylaFAX.
In this case the appropriate device to use is typically named <B>/dev/cu*</B>.
Systems that have this style of device usage include BSDI and SunOS.

<A NAME="Outbound"><P><HR WIDTH=65% ALIGN=right><H3>Configuring Outbound Use</H3></A>

Modems are configured for use with HylaFAX using the
<A HREF="@CGIPATH@/manpage?1+faxaddmodem">faxaddmodem</A> script.
This is an interactive script that walks you through the
configuration and installation of a new or existing modem.  Note that
even if you have a previous version of this software installed you
should run <I>faxaddmodem</I> to update the configuration
information for your modems.

faxaddmodem actually does a lot of work other than configuring
a modem for use by HylaFAX.  Specifically, before faxaddmodem
even begins setting up a modem it:

<UL>
<LI>Verifies that a ``fax'' user is registered in the password file
or YP/NIS database.  If one is not setup, then faxaddmodem
sets one up for you.
The fax user is used in various places in HylaFAX and should normally
be setup to have the same user ID as that of uucp so that UUCP lock
files can be shared.  (If you run IRIX the ``fax'' user will also
be added to the <B>passwd.sgi</B> file so that it does not show up in
the normal palette of users displayed during the login procedure.)

<LI>Verifies that a suitable entry exists in the <B>/etc/services</B>
file or in the equivalent YP/NIS database.
If no entry is present, then one is setup.

<LI>Verifies that the
<A HREF="@CGIPATH@/manpage?1+inetd">inetd(1M)</A>
configuration file includes an entry for the HylaFAX client-server
protocol process
<A HREF="@CGIPATH@/manpage?1+faxd.recv">faxd.recv(1M)</A>
and that the pathname corresponds to the one that was configured.
If an entry is not setup for faxd.recv, then one is added.

<LI>Verifies that a ``FaxMaster'' entry is present in the aliases
database.  This alias is equivalent to the normal PostMaster alias
that is used to deliver mail-related problems;  HylaFAX
directs notices about problems and received facsimile to this alias.
The FaxMaster alias should list those system administrators that will
handle HylaFAX-specific problems.
If an alias is not present, then faxaddmodem sets one up.

</UL>

[<B>NB</B>: <EM>faxaddmodem prompts for permission before
doing any of the above actions</EM>.]

<P>
The remainder of this
section shows a sample configuration session and describes
the work done.  The session is shown indented in a <TT>fixed width
font</TT> with user-supplied input in a <TT><B>bold font</B></TT>.
Comments are shown in a normal or <I>italic</I> font.
faxaddmodem displays the current/default setting for a configuration
parameter enclosed in ``<TT>[]</TT>''; to accept the current value
type a carriage-return.

<P>
This session was collected on a Silicon Graphics Indigo running IRIX 5.3
and communicating with an AT&T DataPort modem.

<P>
Note that if your modem is configured to
communicate to the host at fixed baud rate, then you should use the
<TT>-s</TT> option to lock the host-modem line rate; consult the
<I>faxaddmodem</I> manual page for details.

<UL><PRE><TT>
hyla# <B>faxaddmodem</B>		# NB: must be run as the super-user
Verifying that your system is setup properly for fax service...

Done verifying system setup.

Serial port that modem is connected to []? <B>ttym2</B>

Ok, time to setup a configuration file for the modem.  The manual
page config(4F) may be useful during this process.  Also be aware
that at any time you can safely interrupt this procedure.

No existing configuration, let's do this from scratch.
</TT></PRE></UL>

If you run faxaddmodem and a configuration file already exists, the
server-specific parameters will be carried over to the new configuration
file, but the modem-specific parameters will not.  This is because
faxaddmodem is not intelligent enough to recognize when the old
modem and the new modem are the same type.  In this situation you may
prefer to edit the configuration file using your favorite
text editor instead of using faxaddmodem.

<UL><PRE><TT>
Country code [1]? 
Area code [415]? <B>510</B>
</TT></PRE></UL>

<EM>The area code may be set to a null string or omitted from
the configuration file in countries where the notion of an area code does
not exist.</EM>

<UL><PRE><TT>
Phone number of fax modem [+1.415.965.7824]? <B>+1 510 526-8781</B>
</TT></PRE></UL>

This is the phone number associated with the modem being configured.
By default it is passed as an ``identity'' to peer fax machines 
(see below) and it may also appear on tag lines created by the fax server.
The phone number should be a complete international dialing specification
in the form +&ltcountry code&gt; &ltarea code&gt; &ltlocal part&gt;.
Any other characters that are included for readability are automatically
removed if they might cause problems.

<UL><PRE><TT>
Local identification string (for TSI/CIG) [+14159657824]? <B>+1 510 526-8781</B>
</TT></PRE></UL>

The local identification string is passed to peer fax machines during
communication.  If it is not specified, or set to a null string, then
the canonical phone number for the fax modem is used instead.  Beware
that the CCITT T.30 protocol for facsimile communication specifies
that this string should contain only numbers, blank, and the + symbol.
In practice however, most facsimile machines will accept any ASCII string.

<UL><PRE><TT>
Long distance dialing prefix [1]? 
International dialing prefix [011]? 
Dial string rules file (relative to /var/spool/fax) [etc/dialrules]? <B>etc/dialrules.sf-ba</B>
</TT></PRE></UL>

The dial string rules file holds rules used to convert user-supplied
dialing strings (i.e. phone numbers) to a canonical format and to
prepare strings for delivery to a modem.  The default rules do very
little.  Specific dialing rules may be useful for your site or locale
based on how your modems are connected to the PTT.  Consult the
section in the <A HREF="setup-advanced.html#DialRules">Advanced Server
Configuration</A> chapter for more information.

<UL><PRE><TT>
Tracing during normal server operation [1]? 
Tracing during send and receive sessions [11]? 
</TT></PRE></UL>

These parameters control the tracing/logging done by the server process.
It is important that tracing during send and receive sessions include
sufficient information to diagnose problems.  For Class 1 modems this
parameter is usually set to <TT>0x4f</TT> so that HDLC frames are
included in the logs.  For Class 2 and Class 2.0 modems the default
setting of 11 is typically ok.
Consult the description of the <B>ServerTracing</B> and <B>SessionTracing</B>
configuration parameters in the
<A HREF="@CGIPATH@/manpage?4+config">config(4F)</A> manual
page for detailed information about these parameters.

<UL><PRE><TT>
Protection mode for received facsimile [0600]? 
</TT></PRE></UL>

The default parameter selected here makes all received facsimile accessible
only to the fax user.  It may be desirable to set this parameter to
<TT>0644</TT> so that anyone can look at received facsimile.

<UL><PRE><TT>
Protection mode for session logs [0600]? 
</TT></PRE></UL>

Note that if sensitive information such as credit card access codes
are supplied by users that they will appear in the session logs kept
by the HylaFAX servers.  For this reason the default protection mode
for session logs makes them accessible only to the fax user.  For ease
of debugging however it may be preferrable to select a different
mode for the session logs.

<UL><PRE><TT>
Protection mode for ttym2 [0600]? 
Rings to wait before answering [1]? 
</TT></PRE></UL>

This parameter is used during inbound call handling.  It
specifies the number of rings to wait before answering the phone.
See the section on inbound call handling for a discussion of
the different schemes that HylaFAX supports for handling inbound calls.

<UL><PRE><TT>
Modem speaker volume [off]? 
Command line arguments to getty program ["-h %l dx_%s"]? 
</TT></PRE></UL>

This parameter is also related to inbound call handling.  It controls
whether or not to enable support for inbound data calls and should
not be set without first understanding how to setup your system
for incoming data usage.

<UL><PRE><TT>
Pathname of TSI access control list file (relative to /var/spool/fax) [""]? 
</TT></PRE></UL>

The TSI access control list file can be used to restrict inbound
facsimile usage.  The default parameter does not setup a file so any
inbound facsimile will be accepted.  This parameter is discussed more below.

<UL><PRE><TT>
Tag line font file (relative to /var/spool/fax) [etc/lutRS18.pcf]? 
Tag line format string ["From %%l|%c|Page %%p of %%t"]? 
</TT></PRE></UL>

Tag lines are an optional feature supported by HylaFAX whereby each
page of an outbound facsimile is marked with a line of text that
identifies the sender and possibly more.  A proper description
of the tag line support is provided in the
<A HREF="setup-advanced.html#TagLine">Tagline Configuration</A> chapter.
Note that in the United States some form of identification
of the sender of a facsimile is required by law; properly configured
tag lines are an acceptable form of identification.
Also note that if you specify a tag line font file that does not exist
or that is not a proper font file nothing bad will happen; you just
won't get tag lines on outbound facsimile.
It is ok to initially accept the default parameters and then customize
the setup of tag lines at a later time.

<UL><PRE><TT>
Time before purging a stale UUCP lock file (secs) [10800]? <B>30</B>
</TT></PRE></UL>

This parameter controls the time that a HylaFAX server process
will wait before usurping a UUCP lock file whose owner appears
to be gone.  The default parameter forces these stale lock files
to be left around for 5 minutes; a shorter, more aggressive, time
can be used on systems where applications that use UUCP lock
files are known to be well behaved.

<UL><PRE><TT>
Percent good lines to accept during copy quality checking [95]? 
Max consecutive bad lines to accept during copy quality checking [5]? 
Max number of pages to accept in a received facsimile [25]? 
Syslog facility name for ServerTracing messages [""]? <B>local5</B>
</TT></PRE></UL>

More parameters associated with inbound facsimile jobs; consult
the section below.
The syslog facility controls where HylaFAX directs server tracing-related
messages.  The facility name identifies the syslog facility to
direct the messages to.  By setting this parameter to a non-standard
value HylaFAX messages can easily be recorded in a file separate
from the normal system messages.  Consult the
<A HREF="troubleshooting.html#ServerBasics">Troubleshooting chapter</A>,
<A HREF="@CGIPATH@/manpage?4+config">config(4F)</A>
and
<A HREF="@CGIPATH@/manpage?1+syslogd">syslogd(1M)</A>
manual pages for more information.

<UL><PRE><TT>
Set UID to 0 to manipulate CLOCAL [""]? 
</TT></PRE></UL>

This parameter should only need to be set on Silicon Graphics
systems.  Consult the section on
<A HREF="#IRIX">IRIX-specific guidance</A> for
a description of why this parameter might be used.

<UL><PRE><TT>
The non-default server configuration parameters are:

CountryCode:            1
AreaCode:               510
FAXNumber:              +1 510 526-8781
LongDistancePrefix:     1
InternationalPrefix:    011
DialStringRules:        etc/dialrules.sf-ba
SessionTracing:         11
RingsBeforeAnswer:      1
SpeakerVolume:          off
GettyArgs:              "-h %l dx_%s"
LocalIdentifier:        +1 510 526-8781
TagLineFont:            etc/lutRS18.pcf
TagLineFormat:          "From %%l|%c|Page %%p of %%t"
QualifyTSI:             etc/tsi
MaxRecvPages:           25
UUCPLockTimeout:        30
LogFacility:            local5

Are these ok [yes]? 
</TT></PRE></UL>

This completes the collection of server-related parameters; the
remaining steps identify and configure the modem for use.
If the displayed parameters are unacceptable, typing something other
than <TT>yes</TT> or a carriage return will cause faxaddmodem
to prompt for new/changed parameter settings.

<UL><PRE><TT>
Now we are going to probe the tty port to figure out the type
of modem that is attached.  This takes a few seconds, so be patient.
Note that if you do not have the modem cabled to the port, or the
modem is turned off, this may hang (just go and cable up the modem
or turn it on, or whatever).

Probing for best speed to talk to modem: 38400 OK.

This modem looks to have support for both Class 1 and 2;
how should it be configured [2]? 
</TT></PRE></UL>

Modems that support multiple classes can be configured to use
any supported class.  By default faxaddmodem prefers Class 2.0
over Class 2 over Class 1.

<UL><PRE><TT>
Hmm, this looks like a Class 2 modem.
Modem manufacturer is "AT&T Paradyne EDC".
Modem model is "3710-A1-201".
DTE-DCE flow control scheme [xonxoff]? 
</TT></PRE></UL>

The flow control scheme requested is either <TT>xonxoff</TT> for
software flow control or <TT>rtscts</TT> for hardware flow control.
Beware of using an improper flow control scheme for the selected
tty device.  On systems where faxaddmodem understands how
tty device names reflect flow control characteristics, selecting
a flow control scheme not supported by the device will cause the
script to prompt for confirmation and/or to change the device
name or the flow control scheme.

<UL><PRE><TT>
Using prototype configuration file att-dataport-2...

The modem configuration parameters are:

ModemFlowControl:       xonxoff
ModemHardFlowCmd:	AT&R0\D1\Q3
ModemSoftFlowCmd:	AT&R1\D0\Q1
ModemRate:              38400
ModemRecvFillOrder:     MSB2LSB
ModemSendFillOrder:     LSB2MSB
ModemSetupAACmd:        AT+FAA=1
ModemSetupDCDCmd:       AT&C1
ModemSetupDTRCmd:       AT&D2
Class2CQCmd:            AT+FCQ=1;+FBADMUL=20;+FBADLIN=10
Class2DCCQueryCmd:      "!(0,1),(0-5),(0-4),(0-2),(0),(0),(0),(0-7)"

Are these ok [yes]? 
</TT></PRE></UL>

The modem-specific configuration parameters are obtained
from prototype configuration files that reside in the <B>config</B>
subdirectory of the HylaFAX spooling area.  These parameters have
been taken from working systems and should provide a functioning configuration
based on the modem type and the selected flow control scheme.
If no prototype configuration file exists for a modem then faxaddmodem
will prompt for parameters.  There are generic prototype configuration
files for Class 1, Class 2, and Class 2.0 modems.
Because there are many configuration parameters for modems it may
be preferrable to use a normal text editor instead of
faxaddmodem when constructing a configuration file for an
unsupported modem,  To do this, simply accept the default parameters
and then edit the generated configuration file before starting up
a server for the modem.  Once a working configuration file is
created it is simple to create a prototype file from it; consult the
<A HREF="@CGIPATH@/manpage?1+faxaddmodem">faxaddmodem(1M)</A>
or
<A HREF="@CGIPATH@/manpage?4+config">config(4F)</A>
manual pages for information on doing this.

<UL><PRE><TT>
Creating new configuration file "/var/spool/fax/etc/config.ttym2".
Creating "/var/spool/fax/FIFO.ttym2" in the spooling directory.
Done setting up the modem configuration.
</TT></PRE></UL>

At this point faxaddmodem compares the parameters setup
for the modem against the parameters setup for the HylaFAX scheduler
process.  If any parameters have changed it prompts to see if
they should be used to create a new configuration file for the
scheduler.  If no parameters have changed this procedure will not
take place.

<UL><PRE><TT>
No existing scheduler configuration, let's do this from scratch.

The non-default scheduler parameters are:

CountryCode:            1
AreaCode:               510
LongDistancePrefix:     1
InternationalPrefix:    011
DialStringRules:        etc/dialrules.sf-ba
SessionTracing:         11
UUCPLockTimeout:        30

Are these ok [yes]? 
Creating new configuration file "/var/spool/fax/etc/config".

Don't forget to restart faxq with "-m ttym2" or configure init
to run faxgetty on ttym2 (if faxq is already running).
</TT></PRE></UL>

That's all there is to setting up a basic configuration; or at least
<EM>all there should be to it!</EM>
Once a configuration file is setup HylaFAX must be notified that a
new modem is to be used.
Otherwise, if the modem was previously in use nothing needs to be
done; the HylaFAX server processes will notice the new configuration
files and automatically use their contents.

<A NAME="Starting"><P><HR WIDTH=65% ALIGN=right><H3>Starting Outbound Service</A></H3>

Outbound service is carried out by the HylaFAX scheduler process, the
<A HREF="@CGIPATH@/manpage?1+faxq">faxq(1M)</A> program.
There is one faxq process for all modems on a system.
The faxq program learns about modems that can be used for outbound
jobs in two ways: from arguments supplied on the command line, or
from messages received from HylaFAX faxgetty processes that are
setup to run on each tty device where a fax modem resides.

<P>
Specifying modems on the command line is useful when HylaFAX
is to be used in a <I>send-only configuration</I>.
Doing this however limits the functionality of the scheduler
because it will not know the capabilities of the modems it is
scheduling.
Instead faxq will assume that each modem is capable
of anything it is requested to do (e.g. send 2D-encoded facsimile).
When the faxq program is able to identify modem capabilities it
can do a more effective job of assigning modems to jobs based
on the capabilities required by the job.

<P>
Modems are specified on the faxq command line using the <TT>-m</TT>
option.  A modem is identified by the tty device it is attached to.
Thus, to start the scheduler up to use two modems, the
following might be used:

<UL><PRE><TT>
hyla# <B>/usr/etc/faxq -m tty01 -m /dev/tty02</B>
</TT></PRE></UL>

Note that devices may be specified with or without a leading
<B>/dev/</B> prefix.
Note also that faxq must be started by the super-user and that it will
automatically detach itself from the controlling tty.  The latter
can be defeated for debugging purposes with the <TT>-D</TT> option.

<P>
When faxq is used in conjunction with faxgetty no modems need
to be specified on the command line.
If modems are specified however it does not matter; faxq will
just treat the modems as capable of all tasks until it receives
information from the faxgetty processes identifying the true
capabilities of the modems.

<P>
If faxq is being used in a send-only mode and a new modem is
added to the system, then faxq must be restarted with new parameters.
The faxquit program is best used to stop a running faxq process;
it works by sending faxq a ``quit'' message.
Note that if faxq is busy processing
a job that it will not process the quit request until it is no longer
busy with its current tasks.  Using faxquit is preferrable to
killing faxq with a signal because it insures that faxq will terminate
in an orderly fashion.  Consult the
<A HREF="@CGIPATH@/manpage?1+faxq">faxq(1M)</A>
manual page for more details on its operation.


<A NAME="Inbound"><P><HR WIDTH=65% ALIGN=right><H3>Setting up Inbound Service</A></H3>

To setup HylaFAX to provide inbound facsimile or data service a
modem configuration file must be setup and
a faxgetty program must be started to listen for input on the tty device.
The configuration file setup is usually done at the same time
that the outbound server is configured; i.e. when faxaddmodem is run.
The faxgetty server for the modem should be setup to be run by the
<A HREF="@CGIPATH@/manpage?1+init">init(1M)</A>
process according to local system conventions.
For System V-based systems this is done by editing the
<B>/etc/inittab</B> file to spawn faxgetty on the appropriate port.
For example, if a modem is to be started on <B>/dev/ttyf2</B> the
following line might be appropriate:

<UL><PRE><TT>
t2:23:respawn:/usr/etc/faxgetty ttyf2    # port 2
</TT></PRE></UL>

For systems that use a BSD-style setup the following line might
be appropriate for the <B>/etc/ttyab</B> file.

<UL><PRE><TT>
cua0    "/usr/etc/faxgetty /dev/cua0"   dialup          on
</TT></PRE></UL>

Note that faxgetty may be run on a modem port whether or not it is
to provide inbound service.
By setting the ``rings before answer'' parameter to zero, a
faxgetty will not answer an
incoming phone call unless it is explicitly commanded to by the
<A HREF="@CGIPATH@/manpage?1+faxanswer">faxanswer(1M)</A>
program.
This may be desirable if a phone line is used for other than
fax and data.

<P>
In general it is desirable to run faxgetty whenever possible because
faxgetty informs the central HylaFAX scheduler process whenever
modems are in use and also identifies the modems' capabilities.
Since faxgetty also does a reliable job of reseting and configuring
recalcitrant modems it may even be desirable to run faxgetty on
non-fax modems.

<P>
The following sections discuss HylaFAX features associated
with servicing inbound calls.

<A NAME="Fax"><P><HR WIDTH=25% ALIGN=center><H4>Facsimile Service</A></H4>

In normal operation HylaFAX will automatically answer inbound phone
calls and receive facsimile.
Facsimile reception is done by the faxgetty server process.
Inbound facsimile are written to the <B>recvq</B> directory
in the spooling area on the server machine.
Facsimile data is stored as a TIFF Class F (TIFF/F) file and
protected according to the <B>RecvFileMode</B> configuration parameter
specified in the modem configuration file.
The maximum number of pages that will be received in a single
call can also be controlled with the <B>MaxRecvPages</B>
configuration parameter.
Finally, HylaFAX provides an access control list mechanism for
restricting recived facsimile according to the TSI
string passed as part of the facsimile protocol;
consult the <B>QualityTSI</B> configuration parameter in the
<A HREF="@CGIPATH@/manpage?4+config">config(4F)</A>
manual page for details.

<A NAME="Data"><P><HR WIDTH=25% ALIGN=center><H4>Data Service</A></H4>

By default HylaFAX does not enable support for inbound data calls.
Data service is not enabled so that naive users do not accidentally
setup inbound access to their system before proper password controls
are in place.
To enable inbound data service the modem configuration file must
be setup to accept data calls and to invoke the normal system
getty program to process the incoming call.
Normally this involves enabling the use of
<I>adaptive-answer</I> functionality
and the setup of the <B>GettyArgs</B> parameter
in the configuration file.

<P>
Adaptive answer is the ability for a modem to determine
whether an incoming phone call is for data, fax, or voice use.
If a modem supports a good adaptive-answering facility
then it should be enabled with the <B>ModemSetupAACmd</B>
and the faxgetty process will automatically service fax, data, or voice
calls <EM>as identified by the modem</EM>.
Most Class 2 and Class 2.0 modems provide adaptive-answer support
and the prototype configuration files that come with HylaFAX
automatically enable it if it is provided by the modem.
Most Class 1 modems do not provide adaptive-answer support, but
HylaFAX provides adaptive-answer support in the server.
Consult the
<A HREF="setup-advanced.html#AdaptiveAnswer">adaptive answer section</A>
in the Advanced Server Configuration chapter for more information
on configuring adaptive-answer support.

<P>
Setting up the <B>GettyArgs</B> parameter requires an
understanding of how to invoke the system getty program.
HylaFAX will invoke the getty program when a data call is
recognized and set up the standard input, output, and error
descriptors to point to the appropriate tty device.
The getty program should not reopen or reinitialize the modem
before doing its work.
Some getty programs are incapable of this and are unsuitable
for use with HylaFAX.
The parameters passed to the getty program must also identify the
speed to use to communicate with the local modem.
Some getty programs want to automatically detect this rate based
on the <TT>CONNECT</TT> message that a modem sends to the host
when a connection is established; these programs are unsuitable for use
with HylaFAX.
A getty program used with HylaFAX must be able to handle a fixed speed
for host-modem communication (i.e. the port rate is locked);
a speed that is specified on the command line.

<P>
For System V-style getty programs the appropriate parameters
are typically of the form:

<UL><PRE><TT>
GettyArgs:	"-h %l dx_%s"
</TT></PRE></UL>

where the <TT>-h</TT> parameter instructs getty to not hangup the
device first, the <TT>%l</TT> parameter is translated to the
device name (``the tty line''), and the <TT>dx_%s</TT> parameter
identifies the <B>/etc/gettydefs</B> entry to use (<TT>%s</TT>
is translated by HylaFAX to the speed used to communicate with
the modem).  Note that the exact parameters to supply depend
on the getty program used; consult local documentation to understand
what options should be used.

<P>
For BSD-style systems, <B>GettyArgs</B> is usually of the form:

<UL><PRE><TT>
GettyArgs:	"std.%s -"
</TT></PRE></UL>

where <TT>std.%s</TT> refers to an entry in the <B>/etc/gettytab</B>
file for a fixed speed port; e.g.

<UL><PRE><TT>
g|std.19200|19200-baud:sp#19200:
h|std.38400|38400-baud:sp#38400:
</TT></PRE></UL>

(Note that as before, the ``<TT>%s</TT>'' is replaced by the speed
for host-modem communication.)

<A NAME="Problems"><P><HR WIDTH=65% ALIGN=right><H3>Modem Configuration Issues</A></H3>

Beware that when faxgetty processes control a modem they
may leave the modem in a state suitable for sending and receiving facsimile.
That is, they may leave the modem running in Class 1, Class 2, or Class 2.0.
This may have implications for data communication programs such as
<I>tip</I>,
<I>cu</I>,
and <I>uucp</I>.  For example, it may be
necessary to force the modem into Class 0 (for data communication) when
placing a call:
<UL><PRE><TT>
AT+FCLASS=0DT&lt;phone number&gt;
</TT></PRE></UL>

How things work depends entirely on the contents of the
modem configuration file.  It is usually a good idea to
setup the configuration parameters so that the modem is
left idling in Class 0 (for data use) when HylaFAX is not
actively using a modem.

<P>
<IMG SRC="icons/warning_icon.gif" ALIGN=left HSPACE=10 VSPACE=6>
<EM>Note that when HylaFAX places an outband facsimile call it
automatically forces the modem into Class 1, 2, or 2.0
<STRONG>before</STRONG> issuing <TT>ModemDialCmd</TT>.
Thus the old FlexFAX trick of changing the class in the
<B>ModemDialCmd</B> parameter should not be used.</EM>

<A NAME="BSDI"><P><HR WIDTH=65% ALIGN=right><H3>BSDI Guidance</A></H3>

Beware that the standard BSDI FlexFAX distribution places certain
server applications such as faxaddmodem in non-standard locations.
This can cause confusion when HylaFAX is installed because the
old faxaddmodem may be accidentally run and generate incorrect
modem configuration files.

<A NAME="IRIX"><P><HR WIDTH=65% ALIGN=right><H3>IRIX Guidance</A></H3>

On Silicon Graphics Indigo and Indy machines
you can not use a Macintosh modem cable to connect your modem
to the DIN-8 connector on the back of your host.
A Macintosh cable uses a special wiring pattern to pass
the RTS and CTS signals between the host and modem.
This wiring is not compatible with the wiring used on SGI machines.
While it may appear that the the modem and cable work,
hardware flow control will not function properly and
data will eventually be lost.  Consult the
<A HREF="@CGIPATH@/manpage?7+serial">serial(7)</A>
manual page for an explanation of how to wire up modem cables.

<P>
The tty device that is used must reflect whether
hardware or software flow control is to be used.
Under IRIX, modem devices (i.e. those that monitor DCD) come
in two flavors: <TT>ttyf*</TT>
devices support RTS/CTS flow control while <TT>ttym*</TT>
devices support XON/XOFF flow control.
If you want to use hardware flow control to communicate with your
modem you should use a <TT>ttyf*</TT> device, otherwise use a
<TT>ttym*</TT> device.
If you fail to use the correct device you may still get the
correct flow control (because later versions of IRIX actually
permit flow control to be switched irrespective of the device
used), but you are likely to collide with other modem users such
as cu, uucp, ppp, and slip that still use the old-style device names
(so UUCP lock files may be created for a different name than the
one HylaFAX is using).

<P>
IRIX 5.2 and 5.3 have a bug in the device driver for the on-board
serial ports on IP20 and IP22 systems that causes RTS/CTS flow control
to be turned off as a
side effect of setting <TT>CLOCAL</TT>.
If hardware flow control is to be used, set the <B>ClocalAsRoot</B>
modem configuration parameter to <TT>No</TT>; see
<A HREF="@CGIPATH@/manpage?4+config">config(4F)</A>.
Note however that this may cause problems with modems that are quick
to drop DCD when carrier is lost because the final status message
to the host may not be received before IRIX closes the file
descriptor on the server process.

<A NAME="SCO"><P><HR WIDTH=65% ALIGN=right><H3>SCO Guidance</A></H3>

The standard SCO serial I/O driver (SIO) does nothing with modem control
lines if <TT>CLOCAL</TT> is set on the tty device.
The usual workaround is to use the FAS driver instead.

<P>
<I>More to be added.</I>

<A NAME="Solaris"><P><HR WIDTH=65% ALIGN=right><H3>Solaris Guidance</A></H3>

Do not use RTS/CTS flow control with serial ports
built around the Zilog ZS8530 chip unless you have
patched your system to support hardware flow control when DCD
is not asserted to the host
(consult the <A HREF="FAQ/Q37.html">FAQ</A> for an explanation).

<P>
Solaris 2.3, and some other SVR4-derived systems, silently
truncate or discard syslog messages longer than about 120 characters.

<A NAME="SunOS"><P><HR WIDTH=65% ALIGN=right><H3>SunOS Guidance</A></H3>

Do not use RTS/CTS flow control with serial ports
built around the Zilog ZS8530 chip unless you have
patched your system to support hardware flow control when DCD
is not asserted to the host
(consult the <A HREF="FAQ/Q37.html">FAQ</A> for an explanation).

<A NAME="Ultrix"><P><HR WIDTH=65% ALIGN=right><H3>Ultrix Guidance</A></H3>

[<CITE>Ed: this information comes from Tom Lislegaard
 <A HREF="mailto:tl@cmr.no"><tl@cmr.no></A>.</CITE>]

Hardware flow control does not work in this release, modems must be configured
to use software flow control.

<P>
Serial ports are conventionally called <B>tty00</B>, <B>tty01</B>,
etc; see <A HREF="@CGIPATH@/manpage?8+MAKEDEV">MAKEDEV(8)</A>
if you need to create devices.

<P>
<A HREF="setup-advanced.html"><IMG SRC="icons/next.gif">
Advanced server configuration</A>.<BR>
<A HREF="toc.html"><IMG SRC="icons/back.gif">
HylaFAX table of contents</A>.<BR>

<HR>

<ADDRESS>
<A HREF="sam.html">Sam Leffler</A> / <A HREF="mailto:sam@engr.sgi.com">sam@engr.sgi.com</A>.
Last updated $Date: 1995/04/04 16:33:44 $.
</ADDRESS>

</BODY>
</HTML>
