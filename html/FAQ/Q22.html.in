<HTML><HEAD><TITLE>
HylaFAQ: How do I use modems connected to a Telebit NetBlazer?
</TITLE></HEAD><BODY>
<H1>Q22: How do I use modems connected to a Telebit NetBlazer?</H1>
<P><HR>
<A HREF="mailto:flexfaq@flake.asd.sgi.com">
<IMG SRC="@HTMLPATH@/icons/faq-feedback.gif" ALT="?" ALIGN=left HSPACE=8 BORDER=0>
</A>
Got something to say about this answer?  Use the 
<A HREF="@CGIPATH@/faq-feedback?Question=How+do+I+use+modems+connected+to+a+Telebit+NetBlazer%3F">
feedback form</A>
to send your comments to the HylaFAQ maintainers, or hit the question mark
button to invoke the mailer.
<BR CLEAR=left><HR>
<DL COMPACT>
<DT>Q.
<DD><I>How do I use modems connected to a Telebit NetBlazer?</I>
<P>
Does FlexFAX work with following configuration:
<LISTING>
--------------          -----------------
|            |          |               |      ---------
|            |          |               |------| Modem | ZyXEL
|  UNIX Host |----------| NetBlazer     |      ---------
|            |          |               |      ---------
|            |          |               |------| Modem | ZyXEL
--------------          -----------------      ---------
</LISTING>
I've a Netblazer with a couple of modems attached. I'm able to
connect to the modems from the UNIX Host via Telnet (I can assign
an IP address to each modem l line).  When Telnetting to the modem
it's almost the same than saying "cu" or "tip".
<P>
<DT>A.
<DD><B>Date</B>: <I>Tue, 24 Aug 93 19:21:55 -0700</I><BR>
<B>From</B>: <A HREF="mailto:cslater@Telebit.COM"><I>cslater@Telebit.COM (Charlie Slater)</I></A><BR>
<B>To</B>: <I>flexfax@sgi.sgi.com</I><BR>
<B>Subject</B>: <I>how to use FlexFAX with NetBlazer</I><BR>

<P>
How to Use FlexFAX with a NetBlazer by C. Slater, Rev 0.1, 8/24/93

<P>
Configure your NetBlazer.

<P>
On the NetBlazer running version 2.1,  I set up my modem on
line01 with these line commands:
<LISTING>
    auto <line> 01 off

    talk 01
    AT&FS58=2&W
    (suspend talk, with ctl-])

    flow 01 cts
    dsrtime 01 0
    ctstime 01 0 
    dtrtime 01 200	
    login 01 off
    char 01 raw
    reset 01
</LISTING>
The line parameters should now look something like this:
<LISTING>
c58:Top>Configure>Line> l 01
Line    Modem        Char's     Use        Command    MFlags
line01  <<None>>     raw        none       <<None>>   <CTS,DCD,DSR,RTS,DTR>
Flags:  0019284f   <DEBUG,CTS,DCD,DSR,NOLOGIN,CTSFL,NOAUTO,RTS,DTR>
DSR: ON        DCD: ON        CTS: ON       RTS: ON       DTR: ON
Speed: 19200    Flow control: cts/rts
Login: OFF      Callin: ON     Access: all     Autoconfigure: off
Modem command delay: 0 milliseconds
Modem status delay (seconds): DCD=0.320     DSR=0.000     CTS=0.000
DTR off time: 100 milliseconds
Idle times (minutes):   receive=27     transmit=27     auto-reset=0
Trace: ON        Callback monitor: OFF
IP address: 143.191.10.58:7001
Terminal type: <<None>>        Rows: not set        Cols: not set
Process = Event Manager, Dial Protocol = Console, state = Idle
</LISTING>

Then I did 
<LISTING>
	server start raw
	save
</LISTING>
Get "nd".  (I got my copy from ftp.uu.net in networking/cisco.)
Build and install it (easy, it's small).
<P>
Start nd:
<LISTING>
nd -\& -r tcpcon -r 1 -l /dev/ptyqe <your_netblazer_host_name> <7000 + line>
</LISTING>
On my BSDI workstation, I did:
<LISTING>
nd -\& -r tcpcon -r 1 -l /dev/ptyqe c58 7001
</LISTING>
to connect nd to line01 on the netblazer named, "c58".
<P>
Telnet to the NetBlazer and run line trace. (E.g.  trace 01 on).
tcpcon should make a connection to line01 and line01 should move
to state "TALK".  The line parameters should now look like this:
<LISTING>
Line    Modem        Char's     Use        Command    MFlags
line01  <<None>>     raw        RAW_CONNEC <<None>>   <CTS,DCD,DSR,RTS,DTR>
Flags:  0019284f   <DEBUG,CTS,DCD,DSR,NOLOGIN,CTSFL,NOAUTO,RTS,DTR>
DSR: ON        DCD: ON        CTS: ON       RTS: ON       DTR: ON
Speed: 19200    Flow control: cts/rts
Login: OFF      Callin: ON     Access: all     Autoconfigure: off
Modem command delay: 0 milliseconds
Modem status delay (seconds): DCD=0.320     DSR=0.000     CTS=0.000
DTR off time: 100 milliseconds
Idle times (minutes):   receive=30     transmit=30     auto-reset=0
Trace: ON        Callback monitor: OFF
IP address: 143.191.10.58:7001
Terminal type: <<None>>        Rows: not set        Cols: not set
Process = line01, Dial Protocol = Console, state = Talk
</LISTING>

In another window, use "tip" or something to test ttyqe.  Send
commands like "at", "at+fmfr?", and "at+fclass=?" to the modem.
When I did this, I saw responses like, "OK", "Telebit", and "0,2".

<P>
Get out of tip (or whatever).  Line trace should show the line moving
to Idle and then back to TALK.

<P>
Almost ready to go.  Now you need to make one source modification.

<P>
faxd goes nuts lowering and raising DTR to make sure that DTR
really comes back on, it closes and opens the tty file.  This is
bad for the raw TCP connection that makes the "nd-NetBlazer" team
work.  FlexFAX does all this for good reasons, but those reasons don't
apply to this configuration.  In my copy, I took the reopen out of
of the FaxModem::reset(long ms) function in  FaxModem.c++.  

<P>
The code I took out out looks like this:
<LISTING>
#ifdef NOTDEF
    /*
     * On some systems lowering and raising DTR is not done
     * properly (DTR is not raised when requested); thus we
     * reopen the device to insure that DTR is reasserted.
     */
    server.reopenDevice();
#endif
</LISTING>

Build, install and start faxd.  
On my BSDI system I did "/usr/libexec/faxd -m /dev/ttyqe".
<P>
At this point I could send FAXs to various number using sendfax.  
<P>
Notes:
<P>
I used a WorldBlazer in my test, but I don't think it matters.
Any modem that works with FlexFAX should work with the NetBlazer
in this configuration.  I used FlexFAX 2.1 and the 2.2beta041
code.
<P>
The dtrtime value (the time the NetBlazer waits for the modem to
boot) of 200 milliseconds is an order of magnitude shorter than it
needs to be in normal worldblazer/netblazer configurations.  I faxd
does its own waiting and it takes a while for flexfax/nd/netblazer
raw TCP will allow to get going.  This gives the modem the extra
2.5 seconds it needs to finish booting.
<P>
Many people would like a more general solution that allowed them
to use a single  modem for anything (SLIP, FAX, etc.) without manual
reconfiguration.  I don't know how to do this, yet.
<P>
I am sure I missed something in the instructions, so when you find
it let me know.
<P>
Thanks!  -charlie

<BR><I><A HREf="mailto:cslater@telebit.com">cslater@telebit.com</A></I>

</DL>
<P><HR>
<ADDRESS>
<A HREF="@HTMLPATH@/sam.html">Sam Leffler</A> / <A HREF="mailto:sam@engr.sgi.com">sam@engr.sgi.com</A>.
</ADDRESS>
</BODY></HTML>
