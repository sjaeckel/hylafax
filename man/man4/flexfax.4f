.\"	$Header: /usr/people/sam/flexkit/fax/man/man4/RCS/flexfax.4f,v 1.1 91/05/11 16:46:34 sam Exp $
.\"
.\" Copyright (c) 1991 by Sam Leffler.
.\" All rights reserved.
.\"
.\" This file is provided for unrestricted use provided that this
.\" legend is included on all tape media and as a part of the
.\" software program in whole or part.  Users may copy, modify or
.\" distribute this file at will.
.\"
.TH FLEXFAX 4F "April 29, 1991"
.SH NAME
FlexFAX \- introduction to 
.I FlexFAX
operation and file formats
.SH DESCRIPTION
.I FlexFAX
is a system for sending and receiving facsimile.
It supports queued transmission and asynchronous 
reception of facsimile.
Ancillary programs are invoked by
the system for flexibility
and configurability.
.I FlexFAX
includes client and server programs to
support remote submission of jobs for transmission,
remote removal of queued jobs, and to remotely
query the status of jobs queued for transmission.
This document describes the organization of the 
filesystem spooling area in which 
.I FlexFAX
server and server-related processes operate, and
introduces the various files that reside in the spooling area.
.SH OVERVIEW
The spooling area is typically located under the
directory
.IR /usr/spool/fax .
Ancillary commands used by the servers
.IR faxd (1M)
and
.IR faxd.recv (1M),
and by the administration tool
.IR faxadmin (1M),
are located in the 
.B bin
subdirectory.
Configuration, access control, and accounting
information are maintained in the
.B etc
subdirectory.
Outgoing facsimile jobs are described by files
in the
.B sendq
subdirectory, while received facsimile are deposited in the
.B recvq
subdirectory.
The
.B docq
and
.B temp
subdirectories are also used in the transmission of facsimile.
The
.B info
subdirectory contains files that describe the capabilities
of facsimile machines that 
.I FlexFAX
has called\-
this information is used in preparing documents for transmission.
.PP
.I FlexFAX
supports multiple facsimile modems on a single host.
Each modem has a server process associated with it
that handles transmission and asynchronous reception.
Server processes operate independently of each other
and utilize file-level locking to avoid conflicts when
handling jobs submitted for transmission.
There are currently no per-modem priority or access control
mechanisms \- all modems are treated equally.
Server processes accept commands through
.SM FIFO
special device files; see
.IR mknod (2).
All server processes listen for commands
written to the file named
.BR FIFO ,
as well as a per-device file named
.BI FIFO .device
(where
.I device
is the name of the device special file to which the
modem is connected; e.g.
.I ttym2
for
.IR /dev/ttym2 .)
To send a command to any server process, one writes to
.BR FIFO .
This is useful, for example, for submitting a job for
transmission.
To send a command to a specific server process, the
.BI FIFO .device
file is used.
.SH SENDING
Each outgoing facsimile job has a job description file
that is placed in the
.B sendq
subdirectory.
This file contains all the information necessary to
manage the transmission; c.f.
.IR sendq (4F).
The actual documents that are to be sent are located
in the
.B docq
subdirectory.
.I FlexFAX
accepts PostScript and 
.SM TIFF
Class F documents for transmission.
PostScript documents are automatically converted to 
.SM TIFF
documents prior to transmission according to the capabilities
of the remote facsimile machine: maximum page width
and length, ability to handle 2D encoded data, ability
to handle high resolution (7 line/mm) data.
This remote machine capability information is stored
in files in the
.B info
subdirectory.
If a machine has not been called before,
.I FlexFAX
assumes the remote machine has the minimum capabilities.
.PP
While a job is being processed by a server process,
its job description file is locked for exclusive
use with
.IR flock (2).
This insures that multiple server processes do not
simultaneously attempt to process a job.
.I Faxadmin
and
.IR faxstat (1)
also use this information to tell if a job is being processed.
.PP
The remote job submission facility includes per-host
access control.
The file
.B etc/hosts
must be present and list those hosts that are
permitted to queue jobs for transmission.
Note that it is necessary to include the ``local host''
definition (usually 127.0.0.1) if local submission
is to be permitted.
.SH RECEIVING
Server processes can be configured to answer incoming
phone calls and automatically receive facsimile.
Received documents are placed in the
.B recvq
subdirectory in the form of
.SM TIFF
Class F files.
The server can be configured to make these files publicly
accessible, or they can be made private in which case
an administrator must manage their delivery.
When a facsimile is received, the server process invokes the
.B bin/notify
command.
The default command is a shell script that sends a mail
message to a well known user, the
.IR FaxMaster ,
but one might also, for example, automatically spool the
document for printing.
.PP
.I FlexFAX
supports a simple form of access control for receiving facsimile.
The server may be configured to check the
Transmission Subscriber Identifiers (\c
.SM TSI \c
) of the remote fax machine against a data base,
.BR etc/tsi .
Only if the 
.SM TSI
is present in the data base, is the remote machine permitted
to transmit a document.
This mechanism can be used, for example, to guard against
.IR "junk fax" .
.SH STATUS
.I FlexFAX
makes heavy use of 
.IR syslog (3)
for logging status and error diagnostics.
The server processes may also be configured to log various
kinds of debugging and tracing information; c.f.
.IR faxd (1M).
.PP
Any problems encountered when transmitting a facsimile
are returned to the user by electronic mail.
A user may also request notification by mail when a
job is requeued; for example, because a call failed.
.PP
The
.IR faxstat
utility provides (remote) status of jobs queued
for transmission.
The
.IR faxadmin
application can be used to monitor both the send and
receive queues.
Both programs also indicate whether or not server
processes are running.
.PP
The file
.B etc/xferlog
contains status information about all facsimile sent and
received on a machine.
This file is in a simple
.SM ASCII
format that is easy to manipulate with programs such as
.IR awk (1),
to generate accounting information.
See
.IR xferlog (4F)
for information about the format.
.SH NOTES
There is no support for priority queueing.
Automatic routing of incoming facsimile is desirable.
.SH FILES
.nf
.ta \w'etc/config.<device>    'u
FIFO	fifo for job submission
FIFO.<device>	fifo for accessing a specific server
bin/deliver	faxd command to deliver a facsimile by mail
bin/faxinfo	command that prints information about received facsimile
bin/faxquit	command to force server to quit
bin/faxsubmit	command to submit a job for transmission
bin/notify	faxd command for handling newly received facsimile
bin/ps2fax	faxd command for converting PostScript to TIFF
bin/submit2at	faxd command for submitting an at(1) job
docq/doc*	documents queued for transmission
etc/config.<device>	configuration data for <device>
etc/hosts	hosts that may submit jobs for transmission
etc/tsi	fax machines that we'll accept transmissions from
etc/xferlog	log of facsimile sent and received
info/*	data base of remote fax machine capabilities
recvq/fax*	received facsimile
sendq/q*	descriptions of jobs queued for transmission
tmp/*	temporary files created when submitting a job
.fi
.SH "SEE ALSO"
.IR faxadmin (1M),
.IR faxd (1M),
.IR faxd.recv (1M),
.IR config (4F),
.IR hosts (4F),
.IR tsi (4F),
.IR xferlog (4F),
.IR sendq (4F),
.IR recvq (4F),
.IR info (4F)
